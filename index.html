<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Aventura de Monta침a Realista</title>
    <style>
        body { 
            margin: 0; 
            overflow: hidden; 
            font-family: Arial, sans-serif;
            touch-action: none;
            background-color: #000;
        }
        #container { 
            position: absolute; 
            width: 100%; 
            height: 100%; 
        }
        #hud {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            z-index: 10;
        }
        #mission-info {
            position: absolute;
            top: 10px;
            right: 10px;
            color: white;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 5px;
            max-width: 200px;
            font-size: 14px;
        }
        #controls {
            position: absolute;
            bottom: 20px;
            left: 0;
            right: 0;
            margin: 0 auto;
            width: 300px;
            color: white;
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 10px;
            text-align: center;
            z-index: 5;
        }
        #joystick-left {
            position: absolute;
            bottom: 100px;
            left: 50px;
            width: 80px;
            height: 80px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            z-index: 5;
        }
        #joystick-right {
            position: absolute;
            bottom: 100px;
            right: 50px;
            width: 80px;
            height: 80px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            z-index: 5;
        }
        .joystick-handle {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            position: absolute;
            top: 20px;
            left: 20px;
            touch-action: none;
        }
        #start-screen {
            position: absolute;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            z-index: 100;
            text-align: center;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 15px 30px;
            margin: 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 18px;
        }
        button:active {
            background: #45a049;
        }
        .orientation-message {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.9);
            color: white;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 200;
            font-size: 1.5em;
            text-align: center;
        }
        #health-bar {
            position: absolute;
            bottom: 20px;
            left: 20px;
            width: 150px;
            height: 20px;
            background: rgba(255, 0, 0, 0.5);
            border-radius: 10px;
            overflow: hidden;
            z-index: 10;
        }
        #health-fill {
            height: 100%;
            width: 100%;
            background: linear-gradient(to right, #ff0000, #00ff00);
            transition: width 0.3s;
        }
        #inventory {
            position: absolute;
            bottom: 50px;
            right: 20px;
            display: flex;
            gap: 5px;
            z-index: 10;
        }
        .inventory-item {
            width: 40px;
            height: 40px;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid #555;
            border-radius: 5px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 20px;
        }
        .active-item {
            border: 2px solid #4CAF50;
            box-shadow: 0 0 10px #4CAF50;
        }
    </style>
</head>
<body>
    <div class="orientation-message" id="orientation-message">
        <h2>Por favor gira tu dispositivo</h2>
        <p>Para una mejor experiencia, usa el simulador en modo horizontal</p>
    </div>

    <div id="container"></div>
    
    <div id="hud">
        <div>Hora: <span id="time">08:00</span></div>
        <div>Temperatura: <span id="temp">15춿C</span></div>
        <div>Altitud: <span id="altitude">1,200</span> m</div>
    </div>
    
    <div id="mission-info">
        <h3>Misi칩n:</h3>
        <p>Llega a la cima de la monta침a</p>
        <p>Distancia: <span id="distance">850</span> m</p>
    </div>
    
    <div id="health-bar">
        <div id="health-fill"></div>
    </div>
    
    <div id="inventory">
        <div class="inventory-item active-item">游븽</div>
        <div class="inventory-item">游댡</div>
        <div class="inventory-item">游븱</div>
        <div class="inventory-item">游꼝</div>
    </div>
    
    <!-- Controles t치ctiles -->
    <div id="joystick-left">
        <div class="joystick-handle" id="left-joystick-handle"></div>
    </div>
    <div id="joystick-right">
        <div class="joystick-handle" id="right-joystick-handle"></div>
    </div>
    
    <div id="start-screen">
        <h1>Aventura de Monta침a Realista</h1>
        <p>Explora paisajes monta침osos realistas y completa misiones desafiantes</p>
        <button id="start-btn">Comenzar Aventura</button>
    </div>

    <!-- A침adir primero SimplexNoise -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/simplex-noise/2.4.0/simplex-noise.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.min.js"></script>
    
    <script>
        // Variables principales
        let scene, camera, renderer, player;
        let clock = new THREE.Clock();
        let terrain, sky, sun;
        let joystickLeftActive = false, joystickRightActive = false;
        let joystickLeftPos = { x: 0, y: 0 }, joystickRightPos = { x: 0, y: 0 };
        let playerStats = {
            health: 100,
            stamina: 100,
            temperature: 15,
            altitude: 1200,
            time: 8,
            inventory: ['pickaxe', 'flashlight', 'water', 'food'],
            currentItem: 0
        };
        
        // Verificar orientaci칩n
        function checkOrientation() {
            const orientationMessage = document.getElementById('orientation-message');
            const isPortrait = window.innerHeight > window.innerWidth;
            
            if (isPortrait) {
                orientationMessage.style.display = 'flex';
            } else {
                orientationMessage.style.display = 'none';
            }
        }
        
        // Inicializaci칩n
        function init() {
            // Verificar orientaci칩n
            checkOrientation();
            window.addEventListener('resize', checkOrientation);
            window.addEventListener('orientationchange', checkOrientation);
            
            // Crear escena
            scene = new THREE.Scene();
            scene.fog = new THREE.FogExp2(0x87CEEB, 0.0005);
            
            // Configurar c치mara
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 5000);
            camera.position.set(0, 1.8, 5);
            
            // Configurar renderizador
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            renderer.physicallyCorrectLights = true;
            document.getElementById('container').appendChild(renderer.domElement);
            
            // A침adir luces
            addLights();
            
            // Crear entorno
            createEnvironment();
            
            // Crear jugador
            createPlayer();
            
            // Configurar controles
            setupControls();
            
            // Mostrar pantalla inicial
            document.getElementById('start-screen').style.display = 'flex';
            
            // Iniciar ciclo del d칤a/noche
            setInterval(updateTime, 60000);
        }
        
        function addLights() {
            // Luz ambiental
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(ambientLight);
            
            // Luz direccional (sol)
            sun = new THREE.DirectionalLight(0xffffff, 1);
            sun.position.set(100, 100, 50);
            sun.castShadow = true;
            sun.shadow.mapSize.width = 2048;
            sun.shadow.mapSize.height = 2048;
            sun.shadow.camera.near = 0.5;
            sun.shadow.camera.far = 500;
            sun.shadow.camera.left = -100;
            sun.shadow.camera.right = 100;
            sun.shadow.camera.top = 100;
            sun.shadow.camera.bottom = -100;
            scene.add(sun);
            
            // Luz de la luna (para noche)
            const moonLight = new THREE.DirectionalLight(0x7da5ff, 0.1);
            moonLight.position.set(-100, 100, -50);
            scene.add(moonLight);
        }
        
        function createEnvironment() {
            // Crear terreno con geometr칤a procedural
            const terrainGeometry = new THREE.PlaneGeometry(2000, 2000, 100, 100);
            const positions = terrainGeometry.attributes.position;
            
            // Generar monta침as realistas con ruido Simplex
            const simplex = new SimplexNoise();
            
            for (let i = 0; i < positions.count; i++) {
                const x = positions.getX(i);
                const y = positions.getY(i);
                
                // Altura base con m칰ltiples capas de ruido para mayor realismo
                let height = 0;
                height += simplex.noise2D(x * 0.005, y * 0.005) * 50;
                height += simplex.noise2D(x * 0.01, y * 0.01) * 30;
                height += simplex.noise2D(x * 0.02, y * 0.02) * 15;
                height = Math.max(0, height);
                
                // Crear un pico principal
                const distToCenter = Math.sqrt(x*x + y*y);
                const peakHeight = Math.max(0, 200 - distToCenter * 0.2);
                height += peakHeight;
                
                positions.setZ(i, height);
            }
            
            terrainGeometry.computeVertexNormals();
            
            // Material del terreno
            const terrainMaterial = new THREE.MeshStandardMaterial({ 
                color: 0x3a5f0b,
                wireframe: false
            });
            
            terrain = new THREE.Mesh(terrainGeometry, terrainMaterial);
            terrain.rotation.x = -Math.PI / 2;
            terrain.receiveShadow = true;
            terrain.castShadow = true;
            scene.add(terrain);
            
            // A침adir objetos al entorno
            addRocksAndTrees();
            
            // Crear cielo
            createSky();
        }
        
        function addRocksAndTrees() {
            // A침adir rocas dispersas
            const rockGeometry = new THREE.DodecahedronGeometry(1, 0);
            const rockMaterial = new THREE.MeshStandardMaterial({ color: 0x777777 });
            const simplex = new SimplexNoise();
            
            for (let i = 0; i < 100; i++) {
                const rock = new THREE.Mesh(rockGeometry, rockMaterial);
                
                // Posici칩n aleatoria en el terreno
                const x = Math.random() * 1800 - 900;
                const y = Math.random() * 1800 - 900;
                const z = getTerrainHeight(x, y);
                
                // Solo colocar rocas en 치reas rocosas
                if (z > 80 && z < 150) {
                    rock.position.set(x, z, y);
                    rock.scale.set(
                        Math.random() * 2 + 0.5,
                        Math.random() * 2 + 0.5,
                        Math.random() * 2 + 0.5
                    );
                    rock.rotation.set(
                        Math.random() * Math.PI,
                        Math.random() * Math.PI,
                        Math.random() * Math.PI
                    );
                    rock.castShadow = true;
                    scene.add(rock);
                }
            }
            
            // A침adir 치rboles simplificados
            const treeGeometry = new THREE.ConeGeometry(1, 3, 8);
            const treeMaterial = new THREE.MeshStandardMaterial({ color: 0x2d5a27 });
            const trunkGeometry = new THREE.CylinderGeometry(0.3, 0.4, 1);
            const trunkMaterial = new THREE.MeshStandardMaterial({ color: 0x5a3a22 });
            
            for (let i = 0; i < 50; i++) {
                const tree = new THREE.Group();
                
                // Posici칩n aleatoria en 치reas verdes
                const x = Math.random() * 1800 - 900;
                const y = Math.random() * 1800 - 900;
                const z = getTerrainHeight(x, y);
                
                if (z > 50 && z < 100) {
                    const trunk = new THREE.Mesh(trunkGeometry, trunkMaterial);
                    trunk.position.y = 0.5;
                    trunk.castShadow = true;
                    tree.add(trunk);
                    
                    const leaves = new THREE.Mesh(treeGeometry, treeMaterial);
                    leaves.position.y = 2.5;
                    leaves.castShadow = true;
                    tree.add(leaves);
                    
                    tree.position.set(x, z, y);
                    tree.scale.set(
                        Math.random() * 0.5 + 0.7,
                        Math.random() * 0.5 + 0.7,
                        Math.random() * 0.5 + 0.7
                    );
                    scene.add(tree);
                }
            }
        }
        
        function createSky() {
            // Cielo con efecto de atm칩sfera
            const skyGeometry = new THREE.SphereGeometry(1000, 32, 32);
            const skyMaterial = new THREE.ShaderMaterial({
                vertexShader: `
                    varying vec3 vWorldPosition;
                    void main() {
                        vec4 worldPosition = modelMatrix * vec4(position, 1.0);
                        vWorldPosition = worldPosition.xyz;
                        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
                    }
                `,
                fragmentShader: `
                    uniform vec3 topColor;
                    uniform vec3 bottomColor;
                    uniform float offset;
                    uniform float exponent;
                    varying vec3 vWorldPosition;
                    void main() {
                        float h = normalize(vWorldPosition + offset).y;
                        gl_FragColor = vec4(mix(bottomColor, topColor, max(pow(max(h, 0.0), exponent)), 1.0);
                    }
                `,
                uniforms: {
                    topColor: { value: new THREE.Color(0x0077ff) },
                    bottomColor: { value: new THREE.Color(0xffffff) },
                    offset: { value: 33 },
                    exponent: { value: 0.6 }
                },
                side: THREE.BackSide
            });
            
            sky = new THREE.Mesh(skyGeometry, skyMaterial);
            scene.add(sky);
        }
        
        function createPlayer() {
            // Modelo simplificado del jugador
            player = new THREE.Group();
            
            // Cuerpo
            const bodyGeometry = new THREE.CylinderGeometry(0.3, 0.3, 1.8, 8);
            const bodyMaterial = new THREE.MeshStandardMaterial({ color: 0x333333 });
            const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
            player.add(body);
            
            // Cabeza
            const headGeometry = new THREE.SphereGeometry(0.25, 16, 16);
            const headMaterial = new THREE.MeshStandardMaterial({ color: 0xffdbac });
            const head = new THREE.Mesh(headGeometry, headMaterial);
            head.position.y = 0.9;
            player.add(head);
            
            player.position.y = getTerrainHeight(0, 0) + 1;
            scene.add(player);
        }
        
        function setupControls() {
            // Configurar controles t치ctiles
            const joystickLeft = document.getElementById('left-joystick-handle');
            const joystickRight = document.getElementById('right-joystick-handle');
            const joystickLeftArea = document.getElementById('joystick-left');
            const joystickRightArea = document.getElementById('joystick-right');
            
            // Joystick izquierdo (movimiento)
            joystickLeft.addEventListener('touchstart', (e) => {
                e.preventDefault();
                joystickLeftActive = true;
                const touch = e.touches[0];
                const rect = joystickLeftArea.getBoundingClientRect();
                joystickLeftPos = {
                    startX: rect.left + rect.width / 2,
                    startY: rect.top + rect.height / 2,
                    x: touch.clientX,
                    y: touch.clientY
                };
                updateJoystickPosition(joystickLeft, joystickLeftPos);
            });
            
            document.addEventListener('touchmove', (e) => {
                if (joystickLeftActive) {
                    e.preventDefault();
                    const touch = e.touches[0];
                    joystickLeftPos.x = touch.clientX;
                    joystickLeftPos.y = touch.clientY;
                    updateJoystickPosition(joystickLeft, joystickLeftPos);
                }
                
                if (joystickRightActive) {
                    e.preventDefault();
                    const touch = e.touches[0];
                    joystickRightPos.x = touch.clientX;
                    joystickRightPos.y = touch.clientY;
                    updateJoystickPosition(joystickRight, joystickRightPos);
                }
            });
            
            document.addEventListener('touchend', (e) => {
                if (joystickLeftActive) {
                    joystickLeftActive = false;
                    joystickLeft.style.transform = 'translate(0, 0)';
                    joystickLeftPos = { x: 0, y: 0 };
                }
                
                if (joystickRightActive) {
                    joystickRightActive = false;
                    joystickRight.style.transform = 'translate(0, 0)';
                    joystickRightPos = { x: 0, y: 0 };
                }
            });
            
            // Joystick derecho (c치mara)
            joystickRight.addEventListener('touchstart', (e) => {
                e.preventDefault();
                joystickRightActive = true;
                const touch = e.touches[0];
                const rect = joystickRightArea.getBoundingClientRect();
                joystickRightPos = {
                    startX: rect.left + rect.width / 2,
                    startY: rect.top + rect.height / 2,
                    x: touch.clientX,
                    y: touch.clientY
                };
                updateJoystickPosition(joystickRight, joystickRightPos);
            });
            
            // Bot칩n de inicio
            document.getElementById('start-btn').addEventListener('click', startGame);
            
            // Redimensionamiento
            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });
            
            // Selecci칩n de inventario
            const inventoryItems = document.querySelectorAll('.inventory-item');
            inventoryItems.forEach((item, index) => {
                item.addEventListener('click', () => {
                    inventoryItems.forEach(i => i.classList.remove('active-item'));
                    item.classList.add('active-item');
                    playerStats.currentItem = index;
                });
            });
        }
        
        function updateJoystickPosition(joystick, pos) {
            const deltaX = pos.x - pos.startX;
            const deltaY = pos.y - pos.startY;
            const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
            const maxDistance = 30;
            
            if (distance > maxDistance) {
                const angle = Math.atan2(deltaY, deltaX);
                deltaX = Math.cos(angle) * maxDistance;
                deltaY = Math.sin(angle) * maxDistance;
            }
            
            joystick.style.transform = `translate(${deltaX}px, ${deltaY}px)`;
        }
        
        function getTerrainHeight(x, y) {
            const simplex = new SimplexNoise();
            const distance = Math.sqrt(x*x + y*y);
            return simplex.noise2D(x * 0.005, y * 0.005) * 50 + 
                   simplex.noise2D(x * 0.01, y * 0.01) * 30 +
                   Math.max(0, 200 - distance * 0.2);
        }
        
        function updateTime() {
            playerStats.time = (playerStats.time + 0.5) % 24;
            document.getElementById('time').textContent = 
                Math.floor(playerStats.time) + ':' + (playerStats.time % 1 === 0 ? '00' : '30');
            
            // Actualizar iluminaci칩n seg칰n la hora
            const hourRatio = playerStats.time / 24;
            sun.intensity = Math.max(0.1, Math.sin(hourRatio * Math.PI) * 1.5);
            
            // Cambiar color de la luz seg칰n la hora
            if (playerStats.time > 6 && playerStats.time < 18) {
                // D칤a
                sun.color.setHSL(0.1, 0.8, 0.8);
                scene.fog.color.setHSL(0.6, 0.6, 0.8);
            } else {
                // Noche/amanecer/atardecer
                const isSunset = (playerStats.time > 17 && playerStats.time < 19) || 
                                (playerStats.time > 5 && playerStats.time < 7);
                
                if (isSunset) {
                    sun.color.setHSL(0.05, 0.9, 0.6);
                    scene.fog.color.setHSL(0.05, 0.7, 0.6);
                } else {
                    sun.color.setHSL(0.7, 0.8, 0.3);
                    scene.fog.color.setHSL(0.7, 0.6, 0.2);
                }
            }
            
            // Actualizar temperatura ambiental
            updateTemperature();
        }
        
        function updateTemperature() {
            const baseTemp = 15;
            const altitudeFactor = playerStats.altitude / 1000 * -6.5;
            const timeFactor = Math.cos((playerStats.time - 12) / 12 * Math.PI) * 10;
            
            playerStats.temperature = baseTemp + altitudeFactor + timeFactor;
            document.getElementById('temp').textContent = Math.round(playerStats.temperature) + '춿C';
            
            // Efectos en el jugador por temperatura
            if (playerStats.temperature < 0) {
                playerStats.health = Math.max(0, playerStats.health - 0.1);
                updateHealthBar();
            }
        }
        
        function updateHealthBar() {
            const healthFill = document.getElementById('health-fill');
            healthFill.style.width = playerStats.health + '%';
            
            if (playerStats.health < 30) {
                healthFill.style.background = '#ff0000';
            } else if (playerStats.health < 60) {
                healthFill.style.background = '#ff9900';
            } else {
                healthFill.style.background = 'linear-gradient(to right, #ff0000, #00ff00)';
            }
        }
        
        function startGame() {
            document.getElementById('start-screen').style.display = 'none';
            animate();
        }
        
        function animate() {
            requestAnimationFrame(animate);
            
            const delta = clock.getDelta();
            
            // Movimiento del jugador
            if (joystickLeftActive) {
                const deltaX = joystickLeftPos.x - joystickLeftPos.startX;
                const deltaY = joystickLeftPos.y - joystickLeftPos.startY;
                
                // Movimiento hacia adelante/atr치s
                const moveSpeed = delta * 5;
                const moveX = -deltaY / 30 * moveSpeed;
                
                // Rotaci칩n del jugador
                player.rotation.y -= deltaX * 0.01;
                
                // Mover al jugador
                const newX = player.position.x + Math.sin(player.rotation.y) * moveX;
                const newZ = player.position.z + Math.cos(player.rotation.y) * moveX;
                const newY = getTerrainHeight(newX, newZ) + 1;
                
                player.position.set(newX, newY, newZ);
                
                // Actualizar altitud
                playerStats.altitude = Math.round(newY);
                document.getElementById('altitude').textContent = playerStats.altitude.toLocaleString();
                
                // Actualizar distancia a la cima
                const distanceToPeak = Math.max(0, 850 - (playerStats.altitude - 1200));
                document.getElementById('distance').textContent = distanceToPeak;
                
                // Consumir energ칤a
                playerStats.stamina = Math.max(0, playerStats.stamina - delta * 0.5);
            }
            
            // Rotaci칩n de la c치mara
            if (joystickRightActive) {
                const deltaX = joystickRightPos.x - joystickRightPos.startX;
                camera.rotation.y -= deltaX * 0.01;
            }
            
            // Posicionar c치mara detr치s del jugador
            camera.position.x = player.position.x;
            camera.position.y = player.position.y + 1.6;
            camera.position.z = player.position.z;
            
            // Rotar c치mara para mirar hacia adelante
            camera.rotation.y = player.rotation.y;
            
            // Actualizar posici칩n del sol
            const timeRatio = playerStats.time / 24 * Math.PI * 2;
            sun.position.x = Math.cos(timeRatio) * 500;
            sun.position.y = Math.sin(timeRatio) * 500 + 200;
            sun.position.z = Math.sin(timeRatio * 0.7) * 500;
            
            renderer.render(scene, camera);
        }
        
        // Inicializar el juego
        init();
    </script>
</body>
</html>